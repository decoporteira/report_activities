<h2>Turma <%= @classroom.name%></h2>
<h4 class="text-secondary"><%= @classroom.teacher.name%> | <%= @classroom.time%></h4>
<p style="color: green"><%= notice %></p>
<br />

<%= render "create_activity" %> <% render @classroom %>
<div>

 

  <% activities_organized=@activities.sort_by(&:date)%>
  <% dates=[]%>
  <% activities_organized.each do |activity| %>
    <% dates << activity.date%>
  <%end%>
  <% dates = dates.reverse%>
  <% dates.uniq.each do |date|%>
  <div class="col mb-4">
    <div class="card shadow-sm">
      <div class="card-header py-1">
        <h4 class="my-1 fw-normal fs-5"><%= date.strftime("%d/%m/%y") %></h4>
      </div>
      <div class="card-body">
   
    
    <% @students.each  do |student|%>
    <p class="card-text"></p>
      <strong><%= student.name%></strong><br/>
      
      <% @activities.where(student_id: student.id, date: date).each do |activity|%>
        <ul>
          <% if (activity.late == 'feito')%>
            <li><%=activity.report %> <span style="color:blue;font-size:14px">(<%=activity.late %>)</span> <% link_to "Edit", edit_activity_path(activity)%><%= link_to edit_activity_path(activity) do %>
                    <i class="fa-regular fa-pen-to-square"></i>
                  <% end %>
                
            </li>
          <% elsif (activity.late == 'entregue com atraso')%>
            <li><%=activity.report %> <span style="color:orange;font-size:14px">(<%=activity.late %>)</span> <% link_to "Edit", edit_activity_path(activity)%><%= link_to edit_activity_path(activity) do %>
                    <i class="fa-regular fa-pen-to-square"></i>
                  <% end %>
            </li>
          <%else%>
            <li><%=activity.report %> <span style="color:red;font-size:14px">(<%=activity.late %>)</span> <% link_to "Edit", edit_activity_path(activity)%><%= link_to edit_activity_path(activity) do %>
                    <i class="fa-regular fa-pen-to-square"></i>
                  <% end %>
            </li>
          <% end %>
        </ul>
      <%end%>
    <%= link_to 'Marcar todas atividades do dia como Ausente', update_late_to_missing_activity_path(:items =>{:student_id => student.id, :date => date} ), data: { "turbo-method": :patch }, remote: true %>
    <%end%>
    
       
      </div>
    </div>
  </div>

  <%end%>
  <br />
  
 
        

  <%= link_to "Edit this classroom" , edit_classroom_path(@classroom),
	class:'btn btn-outline-primary', style:"width:200px" %> | <%= link_to "Back to
	classrooms" , classrooms_path, class:'btn btn-outline-primary',
	style:"width:200px" %>
  <% if current_user.admin?%>
    <%= button_to "Destroy this classroom" , @classroom,
	method: :delete,method: :delete,  form: { data: { turbo_confirm: 'Are you sure?' } }, class:'btn btn-outline-danger mt-4', style:"width:200px" %>
  <% end %>
</div>
