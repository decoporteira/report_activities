<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<h1>Mensalidades a vencer ou atrasadas</h1>
<div class="">
  <input
  class="form-control"
  id="myInput"
  type="text"
  placeholder="Digite o nome, email ou telefone do responsável para filtrar..." />
</div>
<div class="d-flex flex-row  p-2">
  <div class="col-md-5 col-sm-12 px-2">Nome</div>
  <div class="col-md-1 col-sm-4 text-center">Valor</div>
  <div class="col-md-1 col-sm-12 text-center">Vencimento</div>
  <div class="col-md-1 col-sm-12 text-center">Status</div>
  <div class="col-md-1 col-sm-12 text-center">Referente</div>
  <div class="col-md-2 col-sm-12 text-center">Ação</div>
  <div class="col-md-1 col-sm-12 text-center">Edit</div>
</div>
<ul class="list-group" id="myList">
  <% @monthly_fees.each do |monthly_fee|  %>
    <li class="list-group-item ">
      <div class="row align-items-center">
        <div class="col-md-5 col-sm-12"><strong><%= monthly_fee.student.name %></strong> - <%= monthly_fee.student.cpf %> 
          <p class="font-weight-light mb-0"><% monthly_fee.student.financial_responsibles.each do |responsible| %>
            <i><%= responsible.name[0...6] %> - <%= responsible.cpf %></i>
          <% end %></p>

        </div>
        <div class="col-md-1 col-sm-4 text-center"> 
          <%=
              number_to_currency(
                monthly_fee.value,
                unit: 'R$ ',
                separator: ',',
                delimiter: '.',
                precision: 2,
              )
            %>
            </div>
        <div class="col-md-1 col-sm-4 text-center"><%= monthly_fee.due_date.strftime('%d/%m/%Y') %></div>
          <%
              color_statuses = {
                'Paga' => { text: 'Paga', style: 'color: #0d6efd' },
                'A pagar' => { text: 'A pagar', style: 'color: #6c757d' },
                'Atrasada' => { text: 'Atrasada', style: 'color: #dc3545' },
              }
            %>
            <% color_statuses.each do |text, style| %>
              <% if  monthly_fee.status == text %>
                <div class="col-md-1 col-sm-4 text-center" style="<%= style[:style] %>;"><strong><%= monthly_fee.status %></strong></div>
              <% end %>
            <%end%>
        <div class="col-md-1 col-sm-4 text-center"><%= I18n.l(monthly_fee.due_date, format: :short_month) %>
          / <%= monthly_fee.due_date_year %></div>
        <div class="col-md-2 col-sm-12 text-center d-flex justify-content-center">  
          <%
            statuses = {
              'Paga' => {
                text: 'Paga',
                css_class: 'btn btn-outline-primary btn-sm mx-1',
              },
              'A pagar' => {
                text: 'A pagar',
                css_class: 'btn btn-outline-secondary btn-sm mx-1',
              },
              'Atrasada' => {
                text: 'Atrasada',
                css_class: 'btn btn-outline-danger btn-sm mx-1',
              },
            }
          %>

          <% statuses.each do |status, config| %>
            <% if monthly_fee.status != status %>
              <%=
                button_to config[:text],
                          update_paid_path(
                            items: { id: monthly_fee.id, status: status },
                          ),
                          method: :patch,
                          class: config[:css_class]
              %>
            <% end %>
          <% end %>
        </div>
        <div class="col-md-1 col-sm-12 text-center"> 
          <%= link_to 'Info', student_monthly_fee_path(monthly_fee.student, monthly_fee)%>
        </div>
      </div>
    </li>
  <% end %>
</ul>

<script>
  $(document).ready(function () {
    $("#myInput").on("keyup", function () {
      var value = $(this).val().toLowerCase();
      $("#myList li").filter(function () {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
      });
    });
  });
</script>

